generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Barbershop {
  id        String   @id @default(cuid())
  name      String
  phone     String
  address   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users        User[]
  barbers      Barber[]
  clients      Client[]
  services     Service[]
  appointments Appointment[]
  products     Product[]
}

model User {
  id           String     @id @default(cuid())
  email        String     @unique
  password     String
  name         String
  role         Role       @default(ADMIN)
  barbershopId String
  barbershop   Barbershop @relation(fields: [barbershopId], references: [id])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

enum Role {
  ADMIN
  BARBER
}

model Barber {
  id             String         @id @default(cuid())
  name           String
  phone          String?
  commissionRate Float          @default(50)
  isActive       Boolean        @default(true)
  barbershopId   String
  barbershop     Barbershop     @relation(fields: [barbershopId], references: [id])
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  appointments   Appointment[]
  workingHours   WorkingHours[]
  barberServices BarberService[]
}

model WorkingHours {
  id        String  @id @default(cuid())
  barberId  String
  barber    Barber  @relation(fields: [barberId], references: [id], onDelete: Cascade)
  dayOfWeek Int
  startTime String
  endTime   String
  isActive  Boolean @default(true)
}

model Client {
  id           String     @id @default(cuid())
  name         String
  phone        String
  email        String?
  notes        String?
  barbershopId String
  barbershop   Barbershop @relation(fields: [barbershopId], references: [id])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  appointments Appointment[]
}

model Service {
  id           String     @id @default(cuid())
  name         String
  duration     Int
  price        Float
  isActive     Boolean    @default(true)
  barbershopId String
  barbershop   Barbershop @relation(fields: [barbershopId], references: [id])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  barberServices      BarberService[]
  appointmentServices AppointmentService[]
}

model BarberService {
  barberId  String
  serviceId String
  barber    Barber  @relation(fields: [barberId], references: [id], onDelete: Cascade)
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@id([barberId, serviceId])
}

model Appointment {
  id            String            @id @default(cuid())
  date          DateTime
  startTime     String
  endTime       String
  status        AppointmentStatus @default(CONFIRMED)
  notes         String?
  totalValue    Float?
  paymentMethod PaymentMethod?

  clientId     String
  client       Client     @relation(fields: [clientId], references: [id])
  barberId     String
  barber       Barber     @relation(fields: [barberId], references: [id])
  barbershopId String
  barbershop   Barbershop @relation(fields: [barbershopId], references: [id])

  services AppointmentService[]
  products AppointmentProduct[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum AppointmentStatus {
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum PaymentMethod {
  CASH
  PIX
  DEBIT
  CREDIT
}

model AppointmentService {
  appointmentId String
  serviceId     String
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  service       Service     @relation(fields: [serviceId], references: [id])
  price         Float

  @@id([appointmentId, serviceId])
}

model Product {
  id           String     @id @default(cuid())
  name         String
  stock        Int        @default(0)
  minStock     Int        @default(5)
  salePrice    Float
  isActive     Boolean    @default(true)
  barbershopId String
  barbershop   Barbershop @relation(fields: [barbershopId], references: [id])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  sales AppointmentProduct[]
}

model AppointmentProduct {
  appointmentId String
  productId     String
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  product       Product     @relation(fields: [productId], references: [id])
  quantity      Int
  unitPrice     Float

  @@id([appointmentId, productId])
}

